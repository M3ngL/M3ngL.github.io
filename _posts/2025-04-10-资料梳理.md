---
layout: post
title: Ardupilot攻击检测方案
category: "Ardupilot 仿真攻击检测&恢复"
date: 2025-04-10
---

## 背景整理

### 传感器物理攻击背景

**GPS攻击：**

- 欺骗攻击：
  - 攻击者发送伪造的GPS信号，使无人机接收到错误的定位信息。
  - 常见手段包括GPS欺骗器，可以模拟真实的GPS信号，诱导无人机偏离航线或进入禁飞区。
- 干扰攻击：
  - 攻击者使用干扰器发射强电磁波，干扰GPS信号的接收。
  - 可能导致无人机GPS信号丢失，无法进行精确定位。

**IMU攻击：**

- 干扰攻击：
  - IMU包含加速度计和陀螺仪，容易受到振动，或者电磁的干扰，导致测量数据漂移或失真。
  - 攻击者可以通过产生强烈的振动或电磁场，干扰IMU的正常工作。
- 物理破坏：
  - 直接破坏IMU的物理结构，使其无法正常工作。

**磁力计攻击：**

- 干扰攻击：
  - 磁力计测量地磁场，容易受到电磁干扰。
  - 攻击者可以使用电磁干扰设备，干扰磁力计的读数，导致无人机航向错误。
- 欺骗攻击：
  - 使用磁铁等磁性材料，产生虚假的磁场，欺骗磁力计。

**气压计攻击：**

- 干扰攻击：
  - 气压计测量大气压力，用于辅助无人机高度控制。
  - 攻击者可以通过改变无人机周围的气压，干扰气压计的读数。
- 物理破坏：
  - 破坏气压计的传感器元件。

**视觉传感器攻击：**

- 干扰攻击：
  - 视觉传感器包括摄像头等，用于无人机环境感知和避障。
  - 攻击者可以使用激光、强光等手段，干扰视觉传感器的正常工作。
- 欺骗攻击：
  - 通过在视觉传感器前投放伪造的图像，欺骗无人机的视觉识别系统。

**其他物理攻击**：

* 机械干扰

  - 物理撞击和振动：对无人机施加机械震动或撞击，改变传感器（如加速度计和陀螺仪）的测量值。

  - 传感器遮挡：直接遮挡或覆盖传感器（如摄像头或激光测距仪），使其无法获取有效数据。

* 温度和环境条件干预

  - 极端温度：通过改变无人机周围环境温度，使传感器工作在非理想状态，从而影响校准结果。

  - 湿度和尘埃：人为制造高湿度或尘埃环境，干扰光学传感器和激光传感器的正常工作。

---

**物理攻击特点**

- 直接性：物理攻击直接作用于传感器硬件，效果明显。
- 隐蔽性：某些物理攻击手段，如电磁干扰，可能难以被察觉。
- 多样性：物理攻击手段多样，可以针对不同类型的传感器进行攻击。

**防御措施**

- 传感器冗余：使用多个同类型传感器，相互验证，提高数据的可靠性。
- 异常检测：通过算法分析传感器数据，检测异常行为，及时发现攻击。
- 抗干扰设计：在传感器硬件和软件设计中，考虑抗电磁干扰、抗振动等因素。
- 物理屏蔽：对关键传感器进行电磁屏蔽、光学遮挡或安装抗震措施，降低外界攻击的影响。
- 传感器自检：设计自检机制，实时监控传感器状态，一旦发现数据异常或通信中断，及时切换到备用模式或触发Failsafe机制。

### 选择对应攻击的原因

> 攻击的可行性分析
>
> * 真实环境下的攻击方式，如声波
> * 仿真环境下的攻击方式，注入
>
> 代码注入攻击点的造成攻击原理说明

#### 传感器攻击

##### Gyro攻击

**可行性分析：**

- 陀螺仪测量角速度，对无人机的姿态控制至关重要。
- 陀螺仪对振动和电磁干扰敏感，容易受到攻击。

**攻击效果：**

- 真实环境：
  - 使用高强度声波或振动设备，产生与陀螺仪共振的频率，导致其读数失真。
  - 使用强电磁干扰器，干扰陀螺仪的电子元件，使其输出错误数据。
- 仿真环境：
  - 通过代码注入，修改陀螺仪的仿真数据，使其输出错误的角速度值。

**攻击造成的影响：** 无人机姿态错误，从而导致无人机坠毁

#####  GPS攻击

**可行性分析**：

- GPS提供无人机的位置信息，是导航和定位的关键。
- GPS信号较弱，容易受到干扰和欺骗。

**攻击效果**：

- 真实环境：
  - 使用GPS干扰器，发射强电磁波，干扰GPS信号的接收，导致无人机GPS信号丢失。
  - 使用GPS欺骗器，发送伪造的GPS信号，使无人机接收到错误的定位信息，诱导其偏离航线。
- 仿真环境：
  - 通过代码注入，修改GPS的仿真数据，使其输出错误的经纬度和高度信息。

**攻击造成的影响：** 无人机导航错误，从而导致无人机偏离航线。

##### 气压计攻击

**可行性分析**：

- 气压计测量大气压力，用于辅助无人机高度控制。
- 气压计对气压变化敏感，容易受到干扰。

**攻击效果**：

- 真实环境：
  - 使用气压干扰器，改变无人机周围的气压，干扰气压计的读数，导致无人机高度控制错误。
  - 使用高强度声波，干扰气压计的传感器。
- 仿真环境：
  - 通过代码注入，修改气压计的仿真数据，使其输出错误的气压值。

**攻击造成的影响：** 无人机高度控制错误，从而导致无人机坠毁。

#####  IMU攻击（角度增量部分）

**可行性分析**：

- IMU包含陀螺仪和加速度计，提供无人机的姿态和运动信息。
- 角度增量是IMU的重要输出，用于姿态估计。
- IMU容易受到振动和电磁干扰。

**攻击效果**：

- 真实环境：
  - 使用高强度声波或振动设备，干扰IMU的陀螺仪和加速度计，导致角度增量数据失真。
  - 使用强电磁干扰器，干扰IMU的电子元件，使其输出错误数据。
- 仿真环境：
  - 通过代码注入，修改IMU的仿真数据，使其输出错误的角度增量值。

**攻击造成的影响：** 无人机姿态估计错误，从而导致无人机姿态错误，最终导致无人机坠毁。

#####  加速度计攻击

**可行性分析**：

- 加速度计测量无人机的加速度，用于姿态估计和运动控制。
- 加速度计对振动和冲击敏感，容易受到攻击。

**攻击效果**：

- 真实环境：
  - 使用高强度声波或振动设备，产生与加速度计共振的频率，导致其读数失真。
  - 使用强电磁干扰器，干扰加速度计的电子元件，使其输出错误数据。
- 仿真环境：
  - 通过代码注入，修改加速度计的仿真数据，使其输出错误的加速度值。

**攻击造成的影响：** 无人机姿态估计错误，从而导致无人机姿态错误，最终导致无人机坠毁。

---

#### 参数攻击

**PID控制器参数修改的理论效果：**

- **P参数（比例）：** 增大P参数会导致无人机对误差更敏感，可能出现超调和震荡。减小P参数会导致响应缓慢，无法快速纠正误差。
- **I参数（积分）：** 增大I参数会加速消除稳态误差，但可能导致积分饱和和不稳定。减小I参数会减缓稳态误差的消除。
- **D参数（微分）：** 增大D参数可以抑制震荡，但可能放大噪声。减小D参数可能导致震荡和响应滞后。

各个PID控制器在Ardupilot系统中的相对位置和处理顺序

![微信图片_2025030509222](/pic/20250305092228.jpg)

##### 水平方向速度PID参数攻击

**可行性分析：** 

* ArduPilot允许用户通过地面站软件或命令行界面调整水平速度控制器的PID参数。
* 攻击者可以通过入侵无人机或地面站，篡改这些参数，影响无人机的水平运动。
* Y轴速度PID控制器是位置控制系统中的内环控制器，它的输出直接影响水平位置。

**攻击造成的影响：** 水平方向速度不稳定，导致无人机在水平方向上无法准确到达目标位置，出现摇摆，震荡，严重的可能导致无人机坠毁。

##### **Z轴加速度PID参数攻击**

**可行性分析：** 

* ArduPilot允许用户通过地面站软件或命令行界面调整水平速度控制器的PID参数。
* 攻击者可以通过入侵无人机或地面站，篡改这些参数。
* Z轴加速度PID控制器是高度控制系统中最内环的控制器，它的输出直接影响垂直速度

**攻击造成的影响**：垂直方向加速度不稳定，导致无人机在垂直方向上无法保持稳定的高度，出现上下震荡，严重的可能导致无人机坠毁。

##### 角速率PID参数攻击

**可行性分析：**

* ArduPilot允许用户通过地面站软件或命令行界面调整水平速度控制器的PID参数。
* 攻击者可以通过入侵无人机或地面站，篡改这些参数。影响无人机的姿态控制。
* 角速率PID控制器是姿态控制系统中的最内环控制器，它的输出直接影响角度。

**攻击造成的影响：** 无人机姿态不稳定，出现摇摆、翻滚等现象，严重的可能导致无人机失控坠毁。

##### 电机PWM参数攻击

控制电机转速上限/下限的参数

可行性分析：

* 将 `MOT_SPIN_MIN` 提高，使电机无法低速旋转，飞行过程中灵敏度增加，增加不稳定性；
* 将 `MOT_SPIN_MAX` 降低，使电机无法达到应有最大输出，限制飞行速度和爬升能力；
* 修改 `MOT_PWM_MIN/MAX` 改变PWM范围，影响整个电调响应特性，造成推进效率下降。

攻击造成的影响：

姿态严重抖动，但不影响实际飞行轨迹。

> 参数修改后**可能不会被检测为攻击行为**，系统仍然认为这是“合法配置”；
>
> 参数生效通常**无需重启**，可在飞行中即时影响电机行为；
>
> 参数更改后即便恢复正常通信，除非重置参数或检查日志，否则难以发现异常。

### 代码注入攻击

- 原理：
  - 攻击者利用软件漏洞，将恶意代码注入到无人机的飞控系统中。
  - 恶意代码可以修改传感器数据、控制指令等，从而实现攻击效果。
  
- 实现方式：
  - 利用飞控系统的固件漏洞，上传恶意固件。
  - 利用地面站软件的漏洞，发送恶意指令。
  - 利用无线电通讯的漏洞，发送恶意数据包。
  
- 防御：
  - 加强飞控系统的软件安全，及时修复漏洞。
  - 使用加密通信，防止恶意指令和数据包被篡改。
  - 使用入侵检测系统，及时发现异常行为。
  
- 注入值大小的影响

  - IMU数据理论上的攻击是正弦波形？



## 实验

### 实验环境配置

Ubuntu 20.04.6 LTS  WSL

> Ardupilot Copterv4.6.0
>
> > git log hash: 4352129c4d664e4ce768422c8138a882d6af62e0
>
> Python 3.10.12
>
> gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0

Memory:32GB

NVIDIA GeForce RTX 4060 Laptop GPU

jupyter notebook

### 实验步骤

#### 评估指标

**准确率 (Accuracy)**

- **定义**：正确预测的样本数与总样本数之比。
- **意义**：反映模型整体预测的正确性。但在数据不平衡（例如攻击样本较少）的场景下，准确率可能掩盖模型对少数类（攻击）的识别能力。

**精确率 (Precision)**

- **定义**：某个类别被预测正确的样本在所有被预测为该类别的样本中的占比。
- **意义**：代表某类攻击报警的可信度，即模型认为发生了某种攻击时，实际发生攻击的可能性有多大。高精确率意味着较少误报，即减少了对无人机的“假警报”。

**召回率 (Recall) / 检测率 (Detection Rate)**

- **定义**：某个类别的真实样本中，被正确预测的比例。
- **意义**：代表模型的攻击检测能力，即所有实际发生的攻击中，有多少被成功检测出来。高召回率意味着较少漏报，即减少了对真正攻击的忽略。

**F1分数 (F1 Score)**

- **定义**：精确率和召回率的调和平均。
- **意义**：在精确率和召回率之间寻找平衡。F1分数越高，说明模型在保证误报率低的同时，检测率也较高。

**ROC曲线及AUC (Receiver Operating Characteristic and Area Under the Curve)**

- **定义**：ROC 曲线展示了不同阈值下真阳性率 (TPR) 与假阳性率 (FPR) 的变化；AUC 是 ROC 曲线下面积。
- **意义**：评估模型的区分能力，即在不同阈值下，模型能否有效地区分不同类型的攻击。AUC 值越高，模型在不同阈值下的综合表现越好，说明模型具有较好的区分能力。AUC 值能衡量模型在权衡漏报与误报之间的能力。

**混淆矩阵 (Confusion Matrix)**

- **定义**：显示真阳性 (TP)、真阴性 (TN)、假阳性 (FP) 和假阴性 (FN) 的矩阵。
- **意义**：直观地展示模型在各个类别上的表现。

**误报率 (False Positive Rate, FPR) 和 漏报率 (False Negative Rate, FNR)**

- **定义**：将正常飞行误判为攻击的概率/将真正的攻击误判为正常的概率。
- **意义**：过高的误报率会导致大量虚假警报，而过高的漏报率可能使真正的攻击无法被及时发现。

**机载的检测延迟（Detection Latency）**

* **定义**：从攻击发生到检测出攻击所需的时间。
* **意义**：无人机的防御反应速度。

**存储使用量（运行时开销）**

* **定义**：模型在部署以及机载运行时占用的存储资源量。
* **意义**：模型搭载对无人机机载的内存影响

**攻击效果衡量指标**

* **定义**：姿态恶意波动幅度+飞行轨迹偏离幅度
* **意义**：衡量当前攻击对无人机正常飞行的影响程度

#### 数据收集

> 数据收集具体情况

##### 任务路径生成

任务路径使用random模块随机生成，以指定点为中心设置各个航点的经纬度+高度

每个航点的高度和经纬度都不同，生成的任务路径轨迹如下

![image-20250305101456644](https://gitee.com/m3nglin/pic/raw/master/image/image-20250305101456644.png)

其中包括起飞动作，各个航点，指定位置降落的动作，使无人机可以在auto模式下完成起飞到降落的所有动作，而无需再进行人工指令干预。

高度范围 `40 ~ 60m`

经纬度范围大小 `0.001`

##### 开始飞行

由自动化脚本控制Ardupilot项目编译出的可执行文件`arducopter`，与Mavproxy进行仿真交互。

该脚本等待仿真环境内无人机初始化完成（包括GPS和IMU的初始化）。完成后，切换飞行模式为`Guided`且加载随机化生成的飞行任务。加载完成后，打开电机，设置起飞高度。设置完成后立刻切换`auto`模式，自此无人机将按照随机化预定好的飞行路径飞行。

##### 开始攻击

如果是收集攻击情况的数据，那么在起飞后的指定时间时刻，自动化脚本通过mavlink指令向仿真无人机发送设置参数的指令（在飞控项目编译阶段前已经配置好，指定某个参数为1时，对应某种随机注入攻击的开始），无人机将实时受到注入攻击的影响。

在攻击一段时间后，自动化脚本再次通过mavlink指令向仿真无人机发送设置参数的指令，将注入攻击关闭，当然在一些攻击情况下，无人机可能还会一直保留受到攻击的相关影响而不能自我恢复到正常情况。

以上出现的攻击相对于起飞开始的时间，攻击持续时间大小，在收集数据时各种攻击情况均保持一致。

##### 飞行完成

当无人机成功降落后（存在少量攻击情况导致仿真无人机无法降落从而无法稳定地下载飞行日志的情况，该情况则略过），自动化脚本开始下载无人机日志。

下载完成后，将日志中的`RATE`字段（10hz收集）以及字段中的数据提取出来，以每次飞行任务为单位转换为dataframe格式并保存为csv文件，方便后续处理。

##### 特殊事件

当无人机坠机 / 接触地面时，即刻停止收集日志信息，不再记录坠机后但ardupilot持续记录的信息，如`IMU-attack`

或者无人机在遭受攻击后，导致长期姿态不稳定或者偏航过大，在攻击结束后一段时间内若还未正常完成飞行任务，则日志不再收集后续飞行数据。因为后续时间内可能还残有攻击影响，或者已经完全恢复但由于之前的偏航离任务中的航点较远，无法在正常时间内到达。

> 正常到达时间定义：正常情况下完成整个飞行任务所需要的时间（任务路径一致），允许一定的误差

缺点：Yaw和YawDes，以及Accel和AccelOut在接触地面后，还会有一些特殊的值（正常情况和攻击后成功恢复的情况都有，且一致）

#### 数据处理

对每个飞行任务的数据，使用滑动时间窗口提取每段数据进行数据处理。其中滑动窗口的步长为一个样本，窗口长度为20个样本，每两个样本之间的时间距离为0.1s，即该日志字段采集的频率为10hz。

计算估计值和系统期望值的差值，单独成列。

（窗口内标准化考虑去除）对窗口内的差值数据进行标准化，再使用标准化后的数据计算相关特征，如最大值/最小值/标准差/峰值因子/平均值。

以飞行任务为单位加上特征量TaskID（暂时还没用上，只是分割测试集/训练集前排序），以及后续多分类的Y值（如0/1/2）。

将同一种分类的飞行任务的特征量数据合并在一起，另存为新的csv文件。

#### 模型训练

使用决策树模型，超参数设置最大深度 `max_depth=7`

样本标签设置为，在一攻击飞行任务过程中，攻击阶段标签设置为非0，没有进行攻击的阶段标签设置为0

训练集和测试集比例切割为8：2

> 考虑加入：任务级别的交叉验证，即同一任务下的样本不再同时随机分到训练集和预测集两侧
>
> 剪枝（Pruning）：在训练过程中移除对预测贡献较小的节点，减少树的深度和复杂度。
>
> 特征选择：减少输入特征的数量，降低计算负担。

### 结果分析

#### 模型训练实验评估

> 根据评估指标针对实验结果进行结果分析

##### 三分类模型训练评估

```
Precision (macro-average): 0.9005029322411193
Recall (macro-average): 0.9009713781462025
F1 Score (macro-average): 0.9007143851422718
ROC AUC (macro-average): 0.9697595883360316


Confusion Matrix:
 [[9590  298  505]
 [ 102 4818  276]
 [ 707  145 4941]]
 
 
Classification Report:
               precision    recall  f1-score   support

           0       0.92      0.92      0.92     10393
           1       0.92      0.93      0.92      5196
           2       0.86      0.85      0.86      5793

    accuracy                           0.90     21382
   macro avg       0.90      0.90      0.90     21382
weighted avg       0.90      0.90      0.90     21382
```

传感器攻击被误认为是正常情况，以及正常情况被误认为是传感器攻击，的概率相对较大

且导致传感器攻击情况对应的准确率、召回率以及F1分数较低

传感器攻击和参数攻击以及正常情况的样本数量关系，传感器攻击样本量 + 参数攻击样本量 == 正常情况的样本量

![Confusion_Matrix4](https://gitee.com/m3nglin/pic/raw/master/image/Confusion_Matrix4.jpg)

##### n分类模型训练评估

````
Accuracy: 0.8803666635487793
Precision (macro-average): 0.8479101159511616
Recall (macro-average): 0.8432106659703559
F1 Score (macro-average): 0.8413542670434818
ROC AUC (macro-average): 0.981362844631706

Confusion Matrix:
 [[9576  253   19   94    4  323   70    8   33   53]
 [   4 1293    0   10    0    0    0    0    2    3]
 [   7    1 1311    2    0    2    0    0    0    0]
 [  48    0    0 1080    0  180    5    0    6    0]
 [   7    0    0    1 1285   11    2    0    8    5]
 [ 301    0    0  177    0  820    7    0   13    0]
 [ 269    0    0    0    0  156  811    0   43    0]
 [   0    0    0    0    0    3    1 1261    0    0]
 [  43    0    0   46    0  115    9    0  476   96]
 [   2    0    0   13    2   26    0    0   75  911]]
 
 
Classification Report:
               precision    recall  f1-score   support

           0       0.93      0.92      0.93     10433
           1       0.84      0.99      0.90      1312
           2       0.99      0.99      0.99      1323
           3       0.76      0.82      0.79      1319
           4       1.00      0.97      0.98      1319
           5       0.50      0.62      0.56      1318
           6       0.90      0.63      0.74      1279
           7       0.99      1.00      1.00      1265
           8       0.73      0.61      0.66       785
           9       0.85      0.89      0.87      1029

    accuracy                           0.88     21382
   macro avg       0.85      0.84      0.84     21382
weighted avg       0.89      0.88      0.88     21382

````

n分类模型情况对应到每一种攻击（包括传感器攻击和参数攻击）

进一步发现是尤其是GPS攻击的分类效果不理想，再次是Baro攻击以及IMU攻击分类效果相对不好；分别对应5，6，8分类

参数攻击中是速度PID攻击效果不好，对应分类3

![Confusion_Matrix3](https://gitee.com/m3nglin/pic/raw/master/image/Confusion_Matrix3.jpg)

### 模型部署

> 模型部署的实验情况+评估固件开销/时间开销+方案内存变化
>
> 模型部署步骤

#### 模型部署步骤

* 加载模型

定义一个新的类 `Attack_Detect`，单例初始化该类，初始化时导入加载json格式的机器学习模型

* 收集数据

实时在飞行过程中收集数据，记录到滑动窗口中，窗口步长为1个样本，窗口长度为20个样本（等价于2s），收集点在日志记录函数中，保证了采样频率与训练模型时一致且收集的数据来源一致

> 优化：换一个日志提取点提取，采样频率能高很多

* 数据处理

当滑动窗口塞满样本数据时，进行数据处理：

1. 计算估计值和期望值的差值
2. 对差值数据计算相关特征，包括最大值/最小值/平均值/标准差/峰值因子

* 模型预测分类

输入计算的相关特征后，利用决策树模型的特点，对模型进行递归遍历，查找该时刻样本数据对应的预测分类值

#### 模型部署评估

> 均是搭载三分类模型的模型部署评估

##### 模型大小/复杂度

* 决策树的总节点数量：177 / 175
* 决策树的最大深度：7 / 7
* 模型的存储空间大小：81.0 KB (82,965 字节) /130 KB (133,135 字节)

##### 固件开销

* 内存占用：模型在运行时占用的内存，包括加载模型和处理数据所需的内存。

> Address： 内存映射的起始地址。
>
> Kbytes： 内存映射的大小，以千字节（KB）为单位。
>
> RSS（Resident Set Size）： 进程实际使用的物理内存大小，以 KB 为单位。
>
> Dirty： 进程已修改的内存页大小，以 KB 为单位。
>
> Mapping：内存映射的名称或类型。

**实时预测前的内存占用**

````
Address           Kbytes     RSS   Dirty Mode  Mapping
0000557b80ae8000     396     396       0 r---- arducopter
0000557b80b4b000    3008    2696       0 r-x-- arducopter
0000557b80e3b000     776     272       0 r---- arducopter
0000557b80efd000     184     184     184 r---- arducopter
0000557b80f2b000       8       8       8 rw--- arducopter
0000557b80f2d000     224     224     224 rw---   [ anon ]
0000557ba132c000     828     728     728 rw---   [ anon ]
00007f3ea4000000     132       4       4 rw---   [ anon ]
00007f3ea4021000   65404       0       0 -----   [ anon ]
00007f3eac000000     132       4       4 rw---   [ anon ]
00007f3eac021000   65404       0       0 -----   [ anon ]
00007f3eb0092000       4       0       0 -----   [ anon ]
00007f3eb0093000    8192       8       8 rw---   [ anon ]
00007f3eb0893000       4       0       0 -----   [ anon ]
00007f3eb0894000    8416      28      28 rw---   [ anon ]
00007f3eb10cc000     160     160       0 r---- libc.so.6
00007f3eb10f4000    1620    1120       0 r-x-- libc.so.6
00007f3eb1289000     352     152       0 r---- libc.so.6
00007f3eb12e1000       4       0       0 ----- libc.so.6
00007f3eb12e2000      16      16      16 r---- libc.so.6
00007f3eb12e6000       8       8       8 rw--- libc.so.6
00007f3eb12e8000      52      20      20 rw---   [ anon ]
00007f3eb12f5000      12      12       0 r---- libgcc_s.so.1
00007f3eb12f8000      92      64       0 r-x-- libgcc_s.so.1
00007f3eb130f000      16      16       0 r---- libgcc_s.so.1
00007f3eb1313000       4       4       4 r---- libgcc_s.so.1
00007f3eb1314000       4       4       4 rw--- libgcc_s.so.1
00007f3eb1315000      56      56       0 r---- libm.so.6
00007f3eb1323000     496     360       0 r-x-- libm.so.6
00007f3eb139f000     364     248       0 r---- libm.so.6
00007f3eb13fa000       4       4       4 r---- libm.so.6
00007f3eb13fb000       4       4       4 rw--- libm.so.6
00007f3eb13fc000     616     616       0 r---- libstdc++.so.6.0.30
00007f3eb1496000    1092     692       0 r-x-- libstdc++.so.6.0.30
00007f3eb15a7000     444     120       0 r---- libstdc++.so.6.0.30
00007f3eb1616000       4       0       0 ----- libstdc++.so.6.0.30
00007f3eb1617000      44      44      44 r---- libstdc++.so.6.0.30
00007f3eb1622000      12      12      12 rw--- libstdc++.so.6.0.30
00007f3eb1625000      12      12      12 rw---   [ anon ]
00007f3eb164d000       8       8       8 rw---   [ anon ]
00007f3eb164f000       8       8       0 r---- ld-linux-x86-64.so.2
00007f3eb1651000     168     168       0 r-x-- ld-linux-x86-64.so.2
00007f3eb167b000      44      44       0 r---- ld-linux-x86-64.so.2
00007f3eb1687000       8       8       8 r---- ld-linux-x86-64.so.2
00007f3eb1689000       8       8       8 rw--- ld-linux-x86-64.so.2
00007fff71de9000     136      32      32 rw---   [ stack ]
00007fff71e0e000      16       0       0 r----   [ anon ]
00007fff71e12000       8       4       0 r-x--   [ anon ]
---------------- ------- ------- -------
total kB          159004    8576    137
````

**实时预测后的内存占用**

````
1472:   ./arducopter -S --model + --speedup 1 --defaults ../../../Tools/autotest/default_params/copter.parm -I0
Address           Kbytes     RSS   Dirty Mode  Mapping
0000557b80ae8000     396     396       0 r---- arducopter
0000557b80b4b000    3008    2700       0 r-x-- arducopter
0000557b80e3b000     776     272       0 r---- arducopter
0000557b80efd000     184     184     184 r---- arducopter
0000557b80f2b000       8       8       8 rw--- arducopter
0000557b80f2d000     224     224     224 rw---   [ anon ]
0000557ba132c000     828     732     732 rw---   [ anon ]
00007f3ea4000000     132       4       4 rw---   [ anon ]
00007f3ea4021000   65404       0       0 -----   [ anon ]
00007f3eac000000     132       8       8 rw---   [ anon ]
00007f3eac021000   65404       0       0 -----   [ anon ]
00007f3eb0092000       4       0       0 -----   [ anon ]
00007f3eb0093000    8192       8       8 rw---   [ anon ]
00007f3eb0893000       4       0       0 -----   [ anon ]
00007f3eb0894000    8416     228     228 rw---   [ anon ]
00007f3eb10cc000     160     160       0 r---- libc.so.6
00007f3eb10f4000    1620    1120       0 r-x-- libc.so.6
00007f3eb1289000     352     152       0 r---- libc.so.6
00007f3eb12e1000       4       0       0 ----- libc.so.6
00007f3eb12e2000      16      16      16 r---- libc.so.6
00007f3eb12e6000       8       8       8 rw--- libc.so.6
00007f3eb12e8000      52      20      20 rw---   [ anon ]
00007f3eb12f5000      12      12       0 r---- libgcc_s.so.1
00007f3eb12f8000      92      64       0 r-x-- libgcc_s.so.1
00007f3eb130f000      16      16       0 r---- libgcc_s.so.1
00007f3eb1313000       4       4       4 r---- libgcc_s.so.1
00007f3eb1314000       4       4       4 rw--- libgcc_s.so.1
00007f3eb1315000      56      56       0 r---- libm.so.6
00007f3eb1323000     496     360       0 r-x-- libm.so.6
00007f3eb139f000     364     248       0 r---- libm.so.6
00007f3eb13fa000       4       4       4 r---- libm.so.6
00007f3eb13fb000       4       4       4 rw--- libm.so.6
00007f3eb13fc000     616     616       0 r---- libstdc++.so.6.0.30
00007f3eb1496000    1092     692       0 r-x-- libstdc++.so.6.0.30
00007f3eb15a7000     444     120       0 r---- libstdc++.so.6.0.30
00007f3eb1616000       4       0       0 ----- libstdc++.so.6.0.30
00007f3eb1617000      44      44      44 r---- libstdc++.so.6.0.30
00007f3eb1622000      12      12      12 rw--- libstdc++.so.6.0.30
00007f3eb1625000      12      12      12 rw---   [ anon ]
00007f3eb164d000       8       8       8 rw---   [ anon ]
00007f3eb164f000       8       8       0 r---- ld-linux-x86-64.so.2
00007f3eb1651000     168     168       0 r-x-- ld-linux-x86-64.so.2
00007f3eb167b000      44      44       0 r---- ld-linux-x86-64.so.2
00007f3eb1687000       8       8       8 r---- ld-linux-x86-64.so.2
00007f3eb1689000       8       8       8 rw--- ld-linux-x86-64.so.2
00007fff71de9000     136      32      32 rw---   [ stack ]
00007fff71e0e000      16       0       0 r----   [ anon ]
00007fff71e12000       8       4       0 r-x--   [ anon ]
---------------- ------- ------- -------
total kB          159004    8788    1580
````

**搭载模型前的内存占用**

````
3002:   ./arducopter -S --model + --speedup 1 --defaults ../../../Tools/autotest/default_params/copter.parm -I0
Address           Kbytes     RSS   Dirty Mode  Mapping
000055e60661f000     396     396       0 r---- arducopter
000055e606682000    2996    2804       0 r-x-- arducopter
000055e60696f000     772     260       0 r---- arducopter
000055e606a30000     184     184     184 r---- arducopter
000055e606a5e000       8       8       8 rw--- arducopter
000055e606a60000     224     224     224 rw---   [ anon ]
000055e63e054000     808     728     728 rw---   [ anon ]
00007fcb58000000     132       4       4 rw---   [ anon ]
00007fcb58021000   65404       0       0 -----   [ anon ]
00007fcb60000000     132       4       4 rw---   [ anon ]
00007fcb60021000   65404       0       0 -----   [ anon ]
00007fcb64903000       4       0       0 -----   [ anon ]
00007fcb64904000    8192       8       8 rw---   [ anon ]
00007fcb65104000       4       0       0 -----   [ anon ]
00007fcb65105000    8416      28      28 rw---   [ anon ]
00007fcb6593d000     160     160       0 r---- libc.so.6
00007fcb65965000    1620    1052       0 r-x-- libc.so.6
00007fcb65afa000     352     208       0 r---- libc.so.6
00007fcb65b52000       4       0       0 ----- libc.so.6
00007fcb65b53000      16      16      16 r---- libc.so.6
00007fcb65b57000       8       8       8 rw--- libc.so.6
00007fcb65b59000      52      20      20 rw---   [ anon ]
00007fcb65b66000      12      12       0 r---- libgcc_s.so.1
00007fcb65b69000      92      64       0 r-x-- libgcc_s.so.1
00007fcb65b80000      16      16       0 r---- libgcc_s.so.1
00007fcb65b84000       4       4       4 r---- libgcc_s.so.1
00007fcb65b85000       4       4       4 rw--- libgcc_s.so.1
00007fcb65b86000      56      56       0 r---- libm.so.6
00007fcb65b94000     496     360       0 r-x-- libm.so.6
00007fcb65c10000     364     244       0 r---- libm.so.6
00007fcb65c6b000       4       4       4 r---- libm.so.6
00007fcb65c6c000       4       4       4 rw--- libm.so.6
00007fcb65c6d000     616     616       0 r---- libstdc++.so.6.0.30
00007fcb65d07000    1092     688       0 r-x-- libstdc++.so.6.0.30
00007fcb65e18000     444     120       0 r---- libstdc++.so.6.0.30
00007fcb65e87000       4       0       0 ----- libstdc++.so.6.0.30
00007fcb65e88000      44      44      44 r---- libstdc++.so.6.0.30
00007fcb65e93000      12      12      12 rw--- libstdc++.so.6.0.30
00007fcb65e96000      12      12      12 rw---   [ anon ]
00007fcb65ebe000       8       8       8 rw---   [ anon ]
00007fcb65ec0000       8       8       0 r---- ld-linux-x86-64.so.2
00007fcb65ec2000     168     168       0 r-x-- ld-linux-x86-64.so.2
00007fcb65eec000      44      44       0 r---- ld-linux-x86-64.so.2
00007fcb65ef8000       8       8       8 r---- ld-linux-x86-64.so.2
00007fcb65efa000       8       8       8 rw--- ld-linux-x86-64.so.2
00007ffc26206000     136      24      24 rw---   [ stack ]
00007ffc2623c000      16       0       0 r----   [ anon ]
00007ffc26240000       8       4       0 r-x--   [ anon ]
---------------- ------- ------- -------
total kB          158968    8644    1364
````

* 能源消耗：模型在推理过程中消耗的电量



##### 时间开销

* 推理延迟： 模型处理单个输入所需的时间。



* 启动时间：模型从加载到准备好进行推理所需的时间。

当无人机打开油门后，无人机的姿态和加速度期望值和估计值经过无人机系统开始实时计算，当计算的值填满滑动窗口（20个样本，即2s）后，当即开始预测分类无人机攻击/正常状态。

### 对比实验

#### 不同风速对比



#### 不同飞行速度对比



#### 不同时间滑动窗口对比

> 模型训练（不同时间窗口下的结果）



#### 前人实验对比



## 补充

* 部署环节

模型部署的实际效果监控，准确率计算，存储每次预测的分类值以及对应的事件时间

部署部分的相关操作使用定长数组存储数据，不使用std；以及节点意义比较，做成整型比较而不是字符串比较

> 飞控剩余空间60KB

比较内存占用以及

* 训练环节

模型结果保存为二进制文件，减少存储空间占用 

依据树结构优化存储方式，遍历方式，树存储的value值优化；数组存储方式？







比较内存占用的方式：mavlink指令



* 攻击结束后指定一定时间内是攻击，其余时间不再是攻击（确定每种攻击结束后一定时间是攻击阶段，是多少时间）
* 确定固件大小
* 将特征量换成原始值，不再计算diff，这样能体现原有的波动（这样的波动很可能diff和正常值一致），困难：目前的决策树模型可能不支持能识别到单独的原始值特征
* 寻找新的模型存储方式以及调用方式




